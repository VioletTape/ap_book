# 4. Наблюдения для корпоративных финансов

Чтобы полностью понять эту главу, вам нужно сначала прочитать главу [3](3.observations-measurements.md).

В крупных корпорациях легко выявить проблемы высокого уровня, но найти их глубинные причины гораздо сложнее. Такие корпорации генерируют огромное количество информации, которая может быстро утопить любого, кто пытается ее проанализировать.

Например, одним из основных показателей эффективности работы компании является ее конечная выручка. Если выручка заметно снизилась, необходимо провести анализ, чтобы выяснить причину. Такой анализ для компании Aroma Coffee Makers (ACM) показал, что доходы от продажи оборудования сократились, хотя расходы оставались на приемлемом уровне. Это было наиболее заметно в Северо—Восточном регионе. Дальнейший анализ показал, что доходы от продаж их кофемашин семейства 1100 были значительно ниже запланированных, особенно в государственном секторе. Многое из этого — анализ цифр, но дальнейший анализ может быть скорее качественным, чем количественным. Возможно, такие низкие показатели объясняются слабым планом компенсации продаж, или сокращением государственного бюджета, или очень жарким летом, или сильным присутствием конкурентов в данном регионе.

Все это во многом повторяет диагностический процесс, который проводят врачи при изучении симптомов пациента. Начиная с очевидного симптома, мы прослеживаем вероятные причины, руководствуясь нашими знаниями в этой области. Мы надеемся выявить первопричины и затем вылечить их. Исходя из этого широкого представления о схожих процессах, мы можем предположить, что клинические модели можно применить и к корпоративным финансам.

В [главе 3](3.observations-measurements.md) дается описание того, как можно делать качественные и количественные выводы о пациентах в контексте здравоохранения. В конце этой главы я кратко упомянул, что эту модель можно применить и в других контекстах, например при анализе корпоративных финансов. В этой главе мы рассмотрим, как это можно сделать. Модель работает очень хорошо, но требует некоторых модификаций. К счастью, паттерны, описывающие эти модификации, являются скорее расширениями существующей модели, чем ее изменениями.

В первом шаблоне человек заменяется некоторым описанием анализируемого сегмента предприятия. Этот _сегмент предприятия_ (4.1) описывает часть предприятия, определенную по ряду измерений. Каждое измерение представляет собой некоторый способ иерархического разбиения предприятия, например местоположение, ассортимент продукции или рынок. Сегмент предприятия представляет собой комбинацию этих измерений, что широко используется в многомерных базах данных.

_Протокол измерений_ (4.2) описывает, как измерения могут быть вычислены из других измерений с помощью формул, которые являются экземплярами типов моделей. В [главе 3](3.observations-measurements.md) рассматривается, как каждое измерение измеряет тип явления; здесь мы обсуждаем, как протокол измерения определяет способы создания измерений для конкретного типа явления. Мы рассматриваем три разновидности протоколов измерений: _Протоколы причин измерений_ (4.2.2) описывают, как различные типы явлений объединяются для вычисления другого (выручка от продаж — это произведение проданных единиц и средней цены). _Протоколы сравнительных измерений_ (4.2.2) описывают, как один тип явления может меняться между _типами состояния_ (4.2.3) (фактическое и плановое отклонение выручки от продаж). _Комбинации измерений_ (4.2.5) используют измерения, определенные в шаблоне сегмента предприятия, для расчета суммарных значений (расчет выручки от продаж на северо—восток путем суммирования значений для отдельных состояний). Каждый из этих подтипов протокола измерения использует полиморфизм для определения своего значения.

Часто мы используем качественные явления для описания количественных типов явлений. В этом случае мы можем определить явления, связав их с диапазоном значений для типа явления. Сначала нам нужен _диапазон_ (4.3), который позволяет нам описать диапазон между двумя величинами и различные операции, которые мы хотим выполнить с этим диапазоном. Затем мы можем определить _явление с диапазоном_ (4.4), либо добавив диапазон к явлению с помощью _явление с атрибутом диапазон_ (4.4.1), либо с помощью _функции диапазона_ (4.4.2).

Мы можем объединить закономерности, рассмотренные в этой главе, с закономерностями из [главы 3](3.observations-measurements.md) для анализа финансовых данных компании. В разделе 4.5 показано, как мы можем использовать эти закономерности для выявления причин проблем в крупных корпорациях.

Модели, представленные в этой главе, основаны на работе, проделанной группой сотрудников крупной производственной компании. Эта команда изучила возможность использования модели здравоохранения для корпоративных финансов и пришла к выводу, что она является очень полезной основой. Прототипом моделей в этой главе послужил язык C++.

<deflist type="narrow">
    <def title="Ключевые понятия">
        Сегмент предприятия, измерение, протокол измерения, тип состояния
    </def>
</deflist>
 

## 4.1 Сегмент предприятий (Enterprise Segment)

Самое заметное отличие проблемы, которую мы рассматриваем в этой главе, от той, что обсуждалась в главе 3, заключается в том, что здесь мы наблюдаем не за одним пациентом. В некоторых случаях мы рассматриваем всю компанию, но в других случаях наблюдаем только часть компании, например 10—11 продаж эспрессо правительству в Северо—Восточном регионе. С этим можно справиться, рассматривая каждую часть компании и всю компанию в целом как отдельные стороны. Однако важно, чтобы отношения между этими частями компании были понятны.

Таким образом, мы должны изменить отображение от процедуры к пациенту, чтобы оно указывало на другой тип. Этот вопрос я пропустил при обсуждении отображения в главе 3, так что на самом деле это не такая уж проблема, как может показаться на первый взгляд. Оригинальная модель Cosmos [1], на которой основана глава 3, на самом деле не связывает наблюдение с человеком. В действительности связь осуществляется с типом, называемым объектом заботы. Объект заботы сам по себе является обобщением пациента и населения. Популяция — это группа людей, и она используется для того, чтобы можно было проводить наблюдения за группами людей, что особенно важно для общественного здравоохранения.

Для корпоративных финансов нам нужен новый подтип объекта заботы, который мы называем сегментом предприятия, как показано на рисунке 4.1. Сегмент предприятия — это часть компании, определенная весьма специфическим образом.

===IMAGE====

_Пациент из главы 3 — это один из видов объекта заботы, который можно наблюдать._

**Рисунок 4.1 Объект заботы и его подтипы.**


Когда мы рассматриваем предприятие, то видим, что его можно разделить на части по нескольким критериям. Оно может быть разделено по организационному признаку, по географическому положению, по продукту, по отрасли, в которую продается продукт, и так далее. Каждый из этих способов деления может осуществляться более или менее независимо. Каждый из них также может быть выражен в виде иерархии. Например, транснациональная компания может быть разделена сначала по рынку (США), затем по региону (Северо—Восток), затем по области (Нью—Гэмпшир). Каждая из этих независимых иерархий — это измерение предприятия. Нью—Гэмпшир и Северо—Восток — это элементы разных уровней в географическом измерении. Сегмент предприятия — это комбинация элементов измерения, по одному на каждое измерение предприятия. Таким образом, часть ACM, которая представляет собой северо—восток, 11—10, правительство, может быть определена как сегмент предприятия с элементами измерения северо—восток в географическом измерении, 11—10 в измерении продукта и правительство в отраслевом измерении, как показано на рисунке 4.2. Такой подход к анализу, часто называемый звездной схемой [4], широко используется в многомерных базах данных [2].

Определив сегмент предприятия, мы можем сформировать модель взаимосвязей между различными типами, как показано на рисунке 4.3. Мы можем объединять элементы измерений в иерархии. Можно определить множество иерархий элементов измерений. Обратите внимание, что ограничение иерархии на родительскую ассоциацию необходимо, потому что кардинальность сама по себе не обеспечивает иерархию (хотя она может допускать циклы). Сегмент предприятия должен иметь по одному элементу из каждой из этих иерархий, на что указывают три ассоциации из сегмента предприятия. Ограничение на элемент измерения гарантирует, что все иерархии находятся в одном измерении. Модель вполне справится с этой ситуацией, но у нее есть пара недостатков. Во—первых, понятия размерности и уровня размерности не определены должным образом, хотя их можно вывести. Во—вторых, добавление нового измерения приведет к изменению модели.

В модели, показанной на рисунке 4.4, используется явный тип измерения. Каждое измерение содержит иерархию элементов измерения. Затем сегмент предприятия должен иметь одну ссылку на элемент измерения в каждом измерении. Для этого мы можем использовать отображение с ключом (см. раздел 15.2). В сочетании с кардинальностью это отображение утверждает, что для каждого экземпляра ключа (измерения) существует один и только один элемент измерения.

Пример: Мы можем определить сегмент предприятия 11—10, Северо—восточное правительство, связав его с элементами измерений 11—10, Северо—восток и правительство. 11—10 относится к измерению продукта. Северо—восток — в измерении местоположения, а правительство — в измерении отрасли.

Обратите внимание, что каждая иерархия нуждается в вершине, и она не обязательно показывает именованную вещь. Обычно вершину обозначают "все", показывая, что любой сегмент, ссылающийся на нее, не имеет разбиений по этому измерению. Другая конвенция заключается в том, чтобы сделать отображение на элемент измерения необязательным; тогда "nil" будет обозначать вершину дерева. Первый подход является более последовательным, несмотря на немного искусственный верхний элемент.

===IMAGE====

Рисунок 4.2. Как сегменты предприятия связаны с элементами в измерениях.

Один сегмент предприятия представляет собой комбинацию элементов из каждого измерения.

Пример: Если мы добавим измерение канала, то сегмент предприятия 11—10 Северо—восточное правительство будет иметь связь с верхним элементом измерения иерархии каналов. Мы называем этот элемент измерения all.

===IMAGE====

Рисунок 4.3. Определение сегментов предприятия с помощью элементов измерения.

Использование этой модели требует добавления нового подтипа каждый раз, когда добавляется измерение.

===IMAGE====

Рисунок 4.4. Определение сегментов предприятия с помощью измерений и элементов измерений.

Эта модель позволяет добавлять новые размеры без изменения модели. Кроме того, она более компактна.

===IMAGE====

Рисунок 4.5. Добавление уровней измерения на рисунок 4.4. Уровни измерений позволяют дать имя каждому уровню измерения.

Добавление типа для уровня измерения не совсем очевидно. Естественно, каждый элемент измерения имеет уровень измерения. Однако уровень определяется его положением в иерархии измерения. Модель, показанная на рисунке 4.5, решает эту проблему, назначая каждому измерению список для определения его элементов измерения. Элемент измерения использует свой уровень в иерархии и список уровней измерения для определения своего уровня измерения.

Пример: В примере ACM измерение местоположения имеет список уровней измерения: рынок, регион и область. Нью—Гэмпшир определен в иерархии с родителем Северо—Восток, чьим родителем является США, чьим родителем является все. Поскольку он находится на три уровня ниже. Уровень измерения Нью—Гэмпшира — третий в списке: area.

4.1.1 Определение размеров

Как мы можем определить измерения? Самое простое определение заключается в том, что это способы, которыми можно разбить большую организацию на части с помощью некоторой организационной структуры. Однако это определение, как правило, не является наиболее удовлетворительным. Организацию можно разбить на множество частей, в зависимости от ситуации. Кроме того, некоторые измерения не обязательно подходят для организационной системы. Модель на рисунке 4.2 включает в себя разбивку по отраслям, в которые продает ACM, но это не обязательно представляет собой организационную структуру внутри ACM.

Мы можем найти лучший способ определения измерений, посмотрев на нижнюю часть иерархии и спросив, что классифицируется в ней. В примере мы видим, что ACM фокусируется на продаже или аренде кофемашины. Мы можем классифицировать это измерение в зависимости от того, какая машина была продана, какой отдел продаж ее продал и в какую отрасль она была продана. Измерения происходят из классификации этого фокусного события, которое представляет собой таблицу фактов звездной схемы [4].

При определении измерений, используемых в подобном анализе, сначала нужно понять, что представляет собой фокусное событие. Затем мы можем рассмотреть способы, с помощью которых это основное событие можно классифицировать. Из рисунка 4.2 видно, что центральное событие связано с продуктом, который имеет семейство продуктов, группу продуктов, напиток. В аспекте продаж мы видим область, регион и рынок.

Эти измерения и уровни должны быть определены бизнес—аналитиками; на рисунке 4.6 показан хороший способ сделать это. Как видно из рисунка 4.6, эта структура может стать довольно сложной. Измерения не обязательно полностью независимы. Например, обратите внимание, как измерение ценового диапазона пересекается с измерением продукта. Это указывает на то, что у любого продукта будет один конкретный родитель по измерениям продукта и ценового диапазона. Модель на рисунке 4.5 необходимо модифицировать, чтобы учесть это, хотя сомнительно, что это стоит делать, поскольку это несколько усложняет модель. Этот вопрос может быть решен в процессе создания измерений.

===IMAGE====

Рисунок 4.6. Диаграмма Тилака с типичным набором измерений и уровней.

Это полезная диаграмма, если мы не имеем более шести ответвлений от любого уровня. На практике такое случается редко.

Измерения не обязательно должны быть измеряемы до самого низкого уровня. В этом случае анализ до территории отдельного продавца или отдельного клиента может быть нецелесообразным или даже возможным. В этом случае измерения детализируются вплоть до базового события. Тем не менее полезно понимать, что представляют собой нижние уровни, как для будущего развития, так и для того, чтобы видеть основы более высоких уровней.

Полный анализ сферы деятельности клиента предполагает создание бизнес—модели для его области. Она будет включать структурную модель, которая используется для строгого определения измерений. Каждое измерение должно представлять собой иерархический путь по структурной модели. Детали этого процесса выходят за рамки данной главы. Для целей обсуждения мы будем считать, что измерения уже определены.

Размеры могут быть определены пользователем аналитической системы в явном виде. В противном случае они могут быть определены из корпоративных баз данных. В последнем случае каждое измерение нуждается в операции построения, указывающей, как запрашивать корпоративные базы данных. Это позволяет системе добавлять узлы в измерение с течением времени.

4.1.2 Свойства размеров и сегментов предприятия

Важное правило для измерений заключается в том, что измерения на более низких уровнях могут быть правильно объединены в измерения на более высоком уровне. Так, если мы хотим посмотреть выручку от продаж для северо—востока, мы можем сделать это, сложив значения продаж для всех субрегионов северо—восточного региона. Все определяемые измерения должны поддерживать это свойство. Обычно измерения объединяются путем сложения, но есть и исключения (см. раздел 4.2.5).

Наряду с измерениями, определяемыми с помощью бизнес—структур, еще одним распространенным измерением является время. Время рассматривается как измерение путем отнесения основного события к определенному периоду времени. Если эти периоды — месяцы, то мы можем говорить о таких цифрах, как выручка за (11—10, северо—восток, март 1994 года). Это подразумевает элемент измерения для марта 1994 года, который будет дочерним элементом элемента измерения для 1994 года. Временное измерение удовлетворяет свойству комбинируемости, о котором говорилось выше, при условии, что цифры относятся только к данному месяцу (а не к году). Мы можем легко вычислить год к дате из цифр только за месяц, но обычно не комбинируем их по измерению.

Сегменты предприятий имеют одно интересное свойство с более фундаментальными типами: Все сегменты предприятия концептуально существуют. Нет понятия о том, чтобы концептуально создать число 5, количество $5 или дату 1/1/2314. Все эти вещи существуют в нашем сознании, но могут быть созданы как объекты в компьютере. Сегменты предприятия обладают этим свойством. Если все измерения определены с помощью элементов измерений, то все сегменты предприятия концептуально существуют, хотя их можно и не создавать как программные объекты.

Это общее свойство поднимает вопрос о том, следует ли рассматривать сегмент предприятия как фундаментальный тип (см. раздел A.1.5). Если да, то он не должен иметь никаких отображений на нефундаментальные объекты. Элемент измерения и наблюдение (унаследованное от объекта заботы) не являются фундаментальными. Хотя последний можно исключить, первый является частью определения сегмента предприятия и поэтому не может быть исключен. Кроме того, есть смысл сохранить отображение сегмента предприятия на наблюдение, поскольку очень часто требуется найти все наблюдения для данного сегмента предприятия. В итоге кажется, что сегменты предприятий не являются фундаментальными, несмотря на это свойство универсального концептуального существования.

Отнесение сегментов предприятия к нефундаментальным оказывает влияние на интерфейс. Операция create на самом деле является операцией find—or—create. Сначала она проверяет, существует ли требуемый экземпляр сегмента предприятия; если да, то возвращает его, если нет — создает. (Или вы можете считать, что у него нет операции create, а есть только операция find, которая молча создает, когда это необходимо).

## 4.2 Measurement Protocol

## 4.3 Range

## 4.4 Phenomenon with Range

## 4.5 Using the Resulting Framework

## References